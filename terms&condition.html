<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Contracts Dashboard</title>
<link rel="icon" type="image/png" href="SourceOnebg.png" sizes="32x32">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  margin:0;
  padding:30px;
  font-family: "Inter", sans-serif;
  background:#f5f6fa;
  color:#111;
}

h2{
  margin-bottom:25px;
  font-size:26px;
  font-weight:700;
  color:#333;
}

.controls{
  display:flex;
  gap:15px;
  margin-bottom:25px;
}

input,select{
  padding:12px 14px;
  border:1px solid #d0d0d0;
  border-radius:10px;
  font-size:14px;
  background:white;
  width:260px;
}

#contractTable{
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));
  gap:20px;
}

.card{
  background:white;
  padding:18px;
  border-radius:16px;
  box-shadow:0 4px 12px rgba(0,0,0,0.06);
  transition:0.25s;
  border:1px solid #e8e8e8;
}

.card:hover{
  transform: translateY(-2px);
  box-shadow:0 8px 24px rgba(0,0,0,0.08);
}

.card-top{
  display:flex;
  align-items:center;
  gap:15px;
}

.circle-img{
  width:70px;
  height:70px;
  border-radius:50%;
  object-fit:cover;
  border:3px solid #ddd;
  cursor:pointer;
}

.name{
  font-size:18px;
  font-weight:600;
  margin-bottom:4px;
}

.date{
  font-size:13px;
  color:#666;
}

.card-buttons{
  margin-top:15px;
  display:flex;
  gap:10px;
}

button{
  padding:8px 12px;
  border:none;
  border-radius:8px;
  font-size:13px;
  cursor:pointer;
  transition:0.2s;
}

button:hover{ opacity:0.9; }

.view-btn{ background:#2563eb; color:white; }
.delete-btn{ background:#dc2626; color:white; }

/* ---------- FULLSCREEN IMAGE POPUP ---------- */

#imgModal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.7);
  justify-content:center;
  align-items:center;
  z-index:9999;
}

#imgModal img {
  max-width:90%;
  max-height:90%;
  border-radius:12px;
  box-shadow:0 0 25px rgba(255,255,255,0.4);
  animation:zoomIn 0.25s ease;
}

@keyframes zoomIn {
  from { transform:scale(0.8); opacity:0; }
  to { transform:scale(1); opacity:1; }
}
</style>
</head>
<body>

<h2>Employee Contracts Dashboard</h2>

<div class="controls">
  <input type="text" id="searchBox" placeholder="Search employee..." onkeyup="renderTable()">
  <select id="sortType" onchange="renderTable()">
      <option value="new">Newest First</option>
      <option value="old">Oldest First</option>
  </select>
</div>

<div id="contractTable"></div>

<!-- Fullscreen Image Modal -->
<div id="imgModal" onclick="closeZoom()">
  <img id="zoomedImg">
</div>

<script>
// ----------------- Firebase -----------------
const firebaseConfig = {
  apiKey: "AIzaSyAENr32Pk-Sq44tuBPj8c_xXk4qzEa3GJw",
  authDomain: "login-9338e.firebaseapp.com",
  databaseURL: "https://login-9338e-default-rtdb.firebaseio.com",
  projectId: "login-9338e",
  storageBucket: "login-9338e.appspot.com",
  messagingSenderId: "649880075591",
  appId: "1:649880075591:web:a5cd336a03d80e9b656062",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let records = []; 

db.ref("pdfs").on("value", snapshot => {
  records = [];

  snapshot.forEach(snap => {
    const data = snap.val();
    records.push({
      uid: snap.key,
      name: data.name,
      employeeImage: data.employeeImage,
      pdf: data.pdf,
      date: data.createdAt || Date.now()
    });
  });

  renderTable();
});

// -------- Render Cards --------
function renderTable(){
  let search = document.getElementById("searchBox").value.toLowerCase();
  let sort = document.getElementById("sortType").value;

  let filtered = records.filter(r => r.name.toLowerCase().includes(search));

  filtered.sort((a,b) => sort === "new" ? b.date - a.date : a.date - b.date);

  const container = document.getElementById("contractTable");
  container.innerHTML = "";

  filtered.forEach(r => {
    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <div class="card-top">
        <img src="${r.employeeImage}" class="circle-img" onclick="zoomImage('${r.employeeImage}')">
        <div>
          <div class="name">${r.name}</div>
          <div class="date">${new Date(r.date).toLocaleString()}</div>
        </div>
      </div>

      <div class="card-buttons">
        <button class="view-btn" onclick="window.open('${r.pdf}', '_blank')">View</button>
        <button class="delete-btn" onclick="deleteRecord('${r.uid}')">Delete</button>
      </div>
    `;

    container.appendChild(div);
  });
}

// -------- Delete Contract --------
function deleteRecord(uid){
  if(!confirm("Do you want to delete this contract?")) return;

  db.ref("pdfs/" + uid).remove()
    .then(() => alert("Deleted successfully"))
    .catch(() => alert("Error deleting record"));
}

// -------- IMAGE ZOOM --------
function zoomImage(src){
  document.getElementById("zoomedImg").src = src;
  document.getElementById("imgModal").style.display = "flex";
}

function closeZoom(){
  document.getElementById("imgModal").style.display = "none";
}

</script>
</body>
</html>
